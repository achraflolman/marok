<!DOCTYPE html>
<html>
<head>
    <title>Google Drive Authorisatie</title>
</head>
<body>
    <p>Autorisatie in behandeling...</p>
    <script>
        // Deze script zal de autorisatiecode uitlezen en terugsturen naar het hoofdvenster.
        // Zorg ervoor dat dit bestand exact overeenkomt met de REDIRECT_URI in je Cloud Function.

        const params = new URLSearchParams(window.location.search);
        const code = params.get('code');
        const state = params.get('state'); // De user ID die we hebben meegestuurd

        if (code && state) {
            // Stuur de code en state (userId) terug naar het venster dat de pop-up opende.
            // Zorg ervoor dat window.opener bestaat en een postMessage listener heeft.
            if (window.opener) {
                window.opener.postMessage({
                    type: 'googleAuthCode',
                    code: code,
                    state: state // Stuur de state (userId) terug
                }, window.location.origin); // BELANGRIJK: specificeer origin voor veiligheid
            }
            document.body.innerHTML = "<p>Google Drive is succesvol gekoppeld! Je kunt dit venster nu sluiten.</p>";
        } else {
            document.body.innerHTML = "<p>Er is een fout opgetreden tijdens de Google Drive autorisatie. Geen code ontvangen.</p>";
        }
    </script>
</body>
</html>
